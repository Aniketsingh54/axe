# PR #8: Final Polish, Import/Export & Deployment

## System Overview: "The Finish Line"

The system is functionally complete (Logic, AI, Database, Auth). This final PR focuses on **User Convenience** and **Production Readiness**. We are implementing the specific "Deliverables Checklist" items that don't fit into the core execution loop: exporting workflows to files, undoing mistakes, and configuring the app for a seamless Vercel deployment.

## Scope

* **JSON Export/Import:** Implementation of client-side functionality to download the current workflow as a `.json` file and upload a file to replace the canvas state.
* **Undo/Redo:** Integration of `zundo` (temporal middleware for Zustand) or React Flow's `useOnViewportChange` hooks to track history and allow `Ctrl+Z` / `Ctrl+Y`.
* **Deployment Configuration:** Finalizing `next.config.ts` (allowing remote images from Transloadit/Google) and creating a production-ready `.env.example`.
* **Error Boundaries:** Wrapping the Canvas and Sidebars in React Error Boundaries to prevent a white screen of death if a node fails to render.
* **Final UI Tweaks:** Ensuring z-indices are correct (Context Menus > Sidebar > Canvas) and adding the "Pulsating" animation class globally if not already perfect.

## Out of Scope

* New Node features.
* Database schema changes.

---

## üìú The Contract (File Standard)

### 1. JSON Export Schema

When a user clicks "Export JSON", the file must strictly follow this structure so it can be re-imported safely.

```typescript
interface WorkflowFile {
  version: "1.0.0";
  name: string;
  nodes: Node[]; // React Flow Nodes
  edges: Edge[]; // React Flow Edges
  viewport: { x: number; y: number; zoom: number };
}

```

**Constraint:** On Import, the system must validate the JSON schema using **Zod** before attempting to load it into the canvas to prevent crashing the app with malformed data.

### 2. Image Optimization (Next.js Config)

To display the images generated by Transloadit and Google, `next.config.ts` must allow these domains:

```typescript
images: {
  remotePatterns: [
    { protocol: 'https', hostname: 'lh3.googleusercontent.com' }, // Google User Avatars
    { protocol: 'https', hostname: 'transloadit.com' },          // Uploads
    { protocol: 'https', hostname: 'robot-results.transloadit.com' } // Processed results
  ]
}

```

---

## üõ†Ô∏è Implementation Checklist (For Code Agent)

### Step 1: Undo/Redo (`hooks/useStore.ts`)

* [ ] Install `zundo`: `npm install zundo`.
* [ ] Wrap the Zustand store creation with `temporal`.
* [ ] **UI:** Add Undo/Redo buttons to the bottom-left controls (next to Zoom). Bind them to `useStore.temporal.getState().undo()`.

### Step 2: Import/Export Logic (`components/header/WorkflowActions.tsx`)

* [ ] **Export:** Create a function `downloadJson(nodes, edges)` that triggers a browser download of the state object.
* [ ] **Import:** Create a hidden `<input type="file" accept=".json" />`.
* On change, read file -> `JSON.parse` -> Zod Validate -> `store.setNodes()` / `store.setEdges()`.



### Step 3: Deployment Config (`next.config.ts`)

* [ ] Update the config to include the `remotePatterns` listed in the Contract above.
* [ ] Ensure `typescript` and `eslint` ignore build errors if necessary (though fixing them is better) to prevent build failures on Vercel.

### Step 4: Final Visual Polish

* [ ] **Glow Effect Global Class:** Ensure `globals.css` defines the exact animation required for running nodes.
```css
@keyframes pulse-ring {
  0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); }
  70% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); }
  100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
}
.animate-pulse-ring {
  animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

```



---

## üèÅ Project Completion Status

With PR #8 merged, the specific requirements of the assignment are **100% Met**.

1. **Pixel-Perfect UI:** PR #2 & #3.
2. **Auth & DB:** PR #1 & #6.
3. **Trigger.dev Execution:** PR #4.
4. **AI & Media Logic:** PR #5.
5. **History & Persistence:** PR #6.
6. **Complex Logic (DAG/Parallel):** PR #7.
7. **Import/Export & Polish:** PR #8.

**You are now ready to deploy to Vercel and record the Demo Video.**